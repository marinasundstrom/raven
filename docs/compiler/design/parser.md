# Parser

The Parser processes the token stream, analyzes the sequence, and constructs the syntax tree, representing the hierarchical structure of the source code.

## Tokenization

### Token

A **token** (`SyntaxToken`) is a fundamental unit of meaning in source code, representing elements such as identifiers, numeric literals, operators, keywords, and more. Tokens are generated by the **lexer** and serve as input for the **parser**, which uses them to interpret the code's structure and meaning.

Each token is categorized by its **`SyntaxKind`**, which specifies the type or role of the token (e.g., identifier, keyword, or operator).

### Lexer

The **`Lexer`** is responsible for scanning the source code to identify and produce tokens. The **`Tokenizer`** acts as a consumer of the `Lexer`, scanning for trivia and associating it with tokens as either **leading** or **trailing** trivia.

There is potential for these two classes to be merged in the future, combining their functionality into a single unit.

### Trivia
Trivia refers to parts of the code that do not directly impact the programâ€™s functionality but serve as separators or provide structure, such as whitespaces, line breaks, and comments.

Trivia is associated with tokens and categorized as either leading or trailing, based on its position and the presence of line breaks:

*	**Trailing Trivia**: Includes everything following a token up to and including a line break. Whitespaces and comments on the same line as the token are also considered trailing trivia.

* **Leading Trivia**: Consists of any trivia on a new line before a token. Whitespaces at the start of a new line are attached as leading trivia to the first token on that line.

## Methods

- **`SyntaxTree Parse(SourceText sourceText)`**: Parses the entire source code file and generates a complete `SyntaxTree` that represents the structure of the source code.

- **`SyntaxNode? ParseSyntax(Type requestedSyntaxType, SourceText sourceText, int position)`**: Used for incremental parsing, this method parses a specific span of changed text for the requested syntax type. It returns the parsed `SyntaxNode`, which can then be integrated into the existing syntax tree by replacing the corresponding node.

## Reading tokens

Here are the most common methods used when reading the token stream.

### Properties

- **`CurrentToken`**: Represents the most recently read token.

### Methods

- **`SyntaxToken PeekToken()`**  
  Returns the next token without advancing the current position.  

- **`SyntaxToken ReadToken()`**  
  Retrieves the next token and advances the position.  

  - **`SyntaxToken ReadTokenCore()`**  
    Performs the core logic for retrieving the next token. Updates the `_currentPosition` by adding the full width of the token.  

- **`bool IsNextToken(SyntaxKind kind)`**  
  Checks if the next token matches the specified `SyntaxKind`.  

- **`bool ConsumeToken(SyntaxKind kind, out SyntaxToken token)`**  
  Attempts to consume the specified token. If the token matches, it advances the position and sets the consumed token in `token`. If it does not match, the actual token is assigned to `token`, and the method returns `false`.  

- **`bool ConsumeTokenOrMissing(SyntaxKind kind, out SyntaxToken token)`**  
  Attempts to consume the specified token. If the token matches, it advances the position and sets the consumed token in `token`. Otherwise, it creates a "missing" token of the expected kind, assigns it to `token`, and returns `false`.  

- **`bool ConsumeTokenOrNull(SyntaxKind kind, out SyntaxToken? token)`**  
  Attempts to consume the specified token. If the token matches, it advances the position and sets the consumed token in `token`. If it does not match, `token` is set to `null`, and the method returns `false`.  

### Additional Methods

- **`TextSpan GetEndOfLastToken()`**  
  Retrieves the position marking the end of the last successfully read token.  

- **`void SetCurrentPosition(int position)`**  
  Updates the current position to the specified value. This change will affect the span.  