# Bound node emission coverage

`MethodBodyGenerator` lowers each bound block before visiting statements, so any statement shape that is not handled by the emitters must be rewritten away ahead of code generation.【F:src/Raven.CodeAnalysis/CodeGen/MethodBodyGenerator.cs†L454-L477】 Expression emission is driven by a single switch in `ExpressionGenerator`; reaching the default case is a fatal `NotSupportedException`, so every surviving expression node needs explicit coverage or a lowering pass that replaces it.【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L33-L158】 The sections below catalog every bound node in `Raven.CodeAnalysis/BoundTree`, note how it is handled during emission, and call out gaps that still need lowering support.

## Statement nodes

### Lowered before emission
- `BoundWhileStatement` is converted into a labeled block that uses a conditional goto loop.【F:src/Raven.CodeAnalysis/BoundTree/Lowering/Lowerer.Loops.cs†L5-L24】【F:src/Raven.CodeAnalysis/CodeGen/MethodBodyGenerator.cs†L454-L477】
- `BoundBreakStatement` and `BoundContinueStatement` are rewritten to forward gotos that target the enclosing loop’s labels.【F:src/Raven.CodeAnalysis/BoundTree/Lowering/Lowerer.Loops.cs†L26-L41】【F:src/Raven.CodeAnalysis/CodeGen/MethodBodyGenerator.cs†L454-L477】
- `BoundIfStatement` lowers to a block of conditional gotos (with optional else labels) before emission, even though the statement generator still has a direct code path.【F:src/Raven.CodeAnalysis/BoundTree/Lowering/Lowerer.Blocks.cs†L18-L37】【F:src/Raven.CodeAnalysis/CodeGen/MethodBodyGenerator.cs†L454-L477】

### Emitted directly
- `BoundReturnStatement` loads the optional expression, performs any required boxing, and emits `ret` directly.【F:src/Raven.CodeAnalysis/CodeGen/Generators/StatementGenerator.cs†L25-L142】
- `BoundExpressionStatement` evaluates the expression (skipping the pop for unit-returning invocations) and discards the result.【F:src/Raven.CodeAnalysis/CodeGen/Generators/StatementGenerator.cs†L29-L163】
- `BoundAssignmentStatement` relies on the expression generator to emit the assignment expression itself.【F:src/Raven.CodeAnalysis/CodeGen/Generators/StatementGenerator.cs†L33-L168】
- `BoundLocalDeclarationStatement` iterates over each `BoundVariableDeclarator`, emitting initializers (including special nullable flows) and recording captured locals.【F:src/Raven.CodeAnalysis/CodeGen/Generators/StatementGenerator.cs†L37-L438】
- `BoundForStatement` has bespoke array and enumerator paths that materialize the loop and wire up the scope’s continue/break labels.【F:src/Raven.CodeAnalysis/CodeGen/Generators/StatementGenerator.cs†L45-L255】
- `BoundTryStatement` drives `ILGenerator`’s exception regions, visiting `BoundCatchClause` payloads and optional finally blocks with nested scopes.【F:src/Raven.CodeAnalysis/CodeGen/Generators/StatementGenerator.cs†L49-L299】
- `BoundBlockStatement` opens a scope, emits each child statement, and disposes any locals registered for cleanup.【F:src/Raven.CodeAnalysis/CodeGen/Generators/StatementGenerator.cs†L53-L309】
- `BoundLabeledStatement` registers the label with the surrounding scope and emits the nested statement.【F:src/Raven.CodeAnalysis/CodeGen/Generators/StatementGenerator.cs†L57-L322】
- `BoundGotoStatement` and `BoundConditionalGotoStatement` compute the correct target scope, emit required disposals, and branch to the cached label.【F:src/Raven.CodeAnalysis/CodeGen/Generators/StatementGenerator.cs†L61-L355】

### Not currently emitted
- `BoundFunctionStatement` is produced by binding for local functions but never appears in the statement generator’s switch, so it must be eliminated (or wrapped in a lowering) before code generation.【F:src/Raven.CodeAnalysis/BoundTree/BoundFunctionStatement.cs†L3-L10】【F:src/Raven.CodeAnalysis/CodeGen/Generators/StatementGenerator.cs†L21-L68】

## Expression nodes

### Lowered before emission
- `BoundMatchExpression` is lowered to a `BoundBlockExpression` that evaluates the scrutinee, stores results, and jumps between arm blocks; the expression generator retains a fallback implementation but normally sees the lowered block.【F:src/Raven.CodeAnalysis/BoundTree/Lowering/Lowerer.MatchExpression.cs†L9-L52】【F:src/Raven.CodeAnalysis/CodeGen/MethodBodyGenerator.cs†L454-L477】【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L110-L155】【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L754-L809】

### Emitted directly
- Core computation nodes—`BoundBinaryExpression`, `BoundUnaryExpression`, `BoundAssignmentExpression`, `BoundIfExpression`, `BoundBlockExpression`, `BoundTupleExpression`, `BoundObjectCreationExpression`, `BoundInvocationExpression`, `BoundLiteralExpression`, and `BoundParenthesizedExpression`—each route through dedicated helpers in the expression generator’s dispatch table.【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L33-L109】
- Cast and type-related forms (`BoundCastExpression`, `BoundAsExpression`, `BoundTypeExpression`, and `BoundTypeOfExpression`) translate into explicit IL conversions or `ldtoken`/`Type.GetTypeFromHandle` sequences.【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L82-L140】【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L489-L499】【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L170-L175】
- Access nodes—`BoundParameterAccess`, `BoundLocalAccess`, `BoundFieldAccess`, `BoundPropertyAccess`, `BoundMemberAccessExpression`, `BoundConditionalAccessExpression`, and `BoundSelfExpression`—load the appropriate receiver, handle captured locals, and issue field/property gets as needed.【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L47-L168】【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L460-L487】【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L1621-L1735】
- Delegate and lambda forms (`BoundLambdaExpression`, `BoundDelegateCreationExpression`, and the underlying closure plumbing) synthesize delegate instances and ensure nested method bodies are generated as required.【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L149-L220】【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L337-L378】
- Address-of expressions and tuple/member construction (`BoundAddressOfExpression`, `BoundCollectionExpression`, `BoundEmptyCollectionExpression`, `BoundSpreadElement`, `BoundArrayAccessExpression`, and `BoundIndexerAccessExpression`) each have tailored emitters that materialize arrays, invoke collection builders, and iterate over spread elements when necessary.【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L43-L128】【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L1017-L1178】【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L1266-L1297】
- Pattern-aware nodes (`BoundIsPatternExpression` along with `BoundPattern`, `BoundDeclarationPattern`, `BoundConstantPattern`, `BoundAndPattern`, `BoundOrPattern`, `BoundNotPattern`, `BoundDesignator`, and `BoundSingleVariableDesignator`) are evaluated via `EmitIsPatternExpression`, which boxes as needed and then delegates to `EmitPattern`/`EmitDesignation` for the individual pattern shapes.【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L130-L1014】【F:src/Raven.CodeAnalysis/BoundTree/BoundIsPatternExpression.cs†L6-L200】
- `BoundUnitExpression` and `BoundTypeExpression` are acknowledged in the dispatcher so they can be recognized (even though the former emits a literal unit value and the latter is a no-op).【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L142-L147】

### Not currently emitted
- `BoundNamespaceExpression`, `BoundMethodGroupExpression`, `BoundVariableExpression`, and `BoundErrorExpression` have bound representations but no cases in the expression generator; reaching them would fall through to the default `NotSupportedException`, so they must be rewritten or suppressed during lowering.【F:src/Raven.CodeAnalysis/BoundTree/BoundNamespaceExpression.cs†L3-L11】【F:src/Raven.CodeAnalysis/BoundTree/BoundMethodGroupExpression.cs†L7-L52】【F:src/Raven.CodeAnalysis/BoundTree/BoundVariableExpression.cs†L3-L10】【F:src/Raven.CodeAnalysis/BoundTree/BoundErrorExpression.cs†L3-L10】【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L142-L158】

## Supporting bound nodes
- `BoundCatchClause` bodies are emitted inside `EmitTryStatement`, where each clause allocates an optional local for the exception and then visits the catch block.【F:src/Raven.CodeAnalysis/CodeGen/Generators/StatementGenerator.cs†L264-L290】【F:src/Raven.CodeAnalysis/BoundTree/BoundCatchClause.cs†L6-L16】
- `BoundVariableDeclarator` instances drive local slot allocation and initializer emission within `EmitDeclarationStatement`/`EmitDeclarator`.【F:src/Raven.CodeAnalysis/CodeGen/Generators/StatementGenerator.cs†L379-L423】【F:src/Raven.CodeAnalysis/BoundTree/BoundLocalDeclarationStatement.cs†L17-L30】
- Pattern designators (`BoundDesignator`, `BoundSingleVariableDesignator`, and `BoundDiscardDesignator`) obtain locals through `EmitDesignation`, which feeds into the broader pattern emission routines noted above.【F:src/Raven.CodeAnalysis/CodeGen/Generators/ExpressionGenerator.cs†L997-L1014】【F:src/Raven.CodeAnalysis/BoundTree/BoundIsPatternExpression.cs†L167-L201】
- `BoundArgument`, `BoundBinaryOperator`, `BoundUnaryOperator`, and `BoundUnboundLambda` are helper abstractions used during binding or analysis; they are not emitted directly and either fold into other bound nodes or into delegate synthesis steps.【F:src/Raven.CodeAnalysis/BoundTree/BoundArgument.cs†L4-L17】【F:src/Raven.CodeAnalysis/BoundTree/BoundBinaryOperator.cs†L6-L120】【F:src/Raven.CodeAnalysis/BoundTree/BoundUnaryOperator.cs†L1-L60】【F:src/Raven.CodeAnalysis/BoundTree/BoundUnboundLambda.cs†L8-L38】
